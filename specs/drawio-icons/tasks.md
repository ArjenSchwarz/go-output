---
references:
    - specs/drawio-icons/requirements.md
    - specs/drawio-icons/design.md
    - specs/drawio-icons/decision_log.md
---
# Draw.io AWS Icons Implementation Tasks

- [x] 1. Core Package Setup
  - Set up the foundation for the v2/icons package and AWS shape support
  - [x] 1.1. Write unit tests for the icons package structure
    - Create v2/icons/aws_test.go with test stubs for all planned functions
    - Add test cases for successful GetAWSShape lookups
    - Add test cases for missing group errors
    - Add test cases for missing shape errors
    - References: Requirements 6.1, 6.2, 6.3
  - [x] 1.2. Create the icons package and implement core AWS shape functionality
    - Create v2/icons directory structure
    - Copy drawio/shapes/aws.json from v1 to v2/icons/aws.json
    - Create v2/icons/aws.go with package declaration
    - Implement embedded JSON loading using //go:embed directive
    - Implement JSON parsing in init() function with panic on error
    - Create internal map structure map[string]map[string]string for shape storage
    - References: Requirements 1.1, 1.4, 2.3, 2.4, Design: init with panic, Memory Model

- [x] 2. Core API Implementation
  - Implement the main GetAWSShape function with proper error handling
  - [x] 2.1. Write unit tests for GetAWSShape function
    - Test successful retrieval of known shapes like Compute/EC2
    - Test error for non-existent group
    - Test error for non-existent shape within valid group
    - Test case sensitivity for exact matching
    - Test with empty string parameters
    - References: Requirements 1.6, 1.7, 6.1, 6.2, 6.3
  - [x] 2.2. Implement GetAWSShape function
    - Create GetAWSShape(group, title string) (string, error) function signature
    - Implement defensive nested map access pattern
    - Return fmt.Errorf("shape group %q not found", group) for missing groups
    - Return fmt.Errorf("shape %q not found in group %q", title, group) for missing shapes
    - Add comprehensive godoc comments
    - References: Requirements 1.2, 1.6, 2.2, 7.1, Design: Core API

- [x] 3. Helper Functions
  - Implement utility functions for discovering available AWS shapes
  - [x] 3.1. Write unit tests for helper functions
    - Test AllAWSGroups returns alphabetically sorted groups
    - Test AWSShapesInGroup returns alphabetically sorted shapes
    - Test AWSShapesInGroup error handling for invalid groups
    - Test HasAWSShape returns true for existing shapes
    - Test HasAWSShape returns false for non-existing shapes
    - References: Requirements 4.1, 4.2, 4.3, 6.4
  - [x] 3.2. Implement helper functions
    - Implement AllAWSGroups() []string returning sorted group names
    - Implement AWSShapesInGroup(group string) ([]string, error) with sorting
    - Implement HasAWSShape(group, title string) bool for existence checks
    - Handle JSON parsing errors by returning empty slices/false and logging
    - Add godoc comments for each function
    - References: Requirements 4.1, 4.2, 4.3, 4.4, 7.1

- [x] 4. Thread Safety and Performance
  - Ensure the implementation is thread-safe and performant
  - [x] 4.1. Write concurrent access tests
    - Create test with multiple goroutines calling GetAWSShape simultaneously
    - Create test with race detector enabled (go test -race)
    - Test concurrent access to different shapes
    - Test concurrent access to same shape
    - References: Requirements 2.5, 6.5
  - [x] 4.2. Write benchmark tests
    - Create BenchmarkGetAWSShape for single lookup performance
    - Create BenchmarkConcurrentLookups for parallel access performance
    - Use modern b.Loop() pattern from Go 1.24+
    - Verify O(1) lookup performance with 600+ services
    - References: Requirements 5.1, 5.2, 5.3, 5.4, Design: Benchmark Tests

- [x] 5. Draw.io Integration
  - Test and document integration with the existing Draw.io functionality
  - [x] 5.1. Write integration tests with Draw.io
    - Create test showing AWS icons used with DrawIOHeader.Style field
    - Test with placeholder pattern like %AWSIcon% in Style field
    - Test multiple different icons assigned to different nodes
    - Verify style string format matches v1 exactly
    - References: Requirements 3.1, 3.2, 3.3, 3.4, 6.6, Design: Integration Tests
  - [x] 5.2. Create migration compatibility tests
    - Compare GetAWSShape output with v1 for same inputs
    - Verify duplicate key handling consistency (last value wins)
    - Test that style strings are Draw.io-compatible
    - References: Requirements 3.2, Design: Migration Compatibility Test

- [x] 6. Documentation and Examples
  - Create comprehensive documentation for the new icons package
  - [x] 6.1. Write package documentation
    - Create package-level documentation in aws.go with overview
    - Include usage example showing GetAWSShape with Draw.io
    - Reference helper functions for discovering groups
    - Add migration notes explaining change from drawio.GetAWSShape() to icons.GetAWSShape()
    - References: Requirements 7.1, 7.2, 7.3, 7.4
  - [x] 6.2. Create example code
    - Write example function showing basic GetAWSShape usage
    - Write example showing integration with DrawIOContent using placeholders
    - Write example showing how to discover available icons using helper functions
    - Include error handling examples
    - References: Requirements 7.2

- [ ] 7. Final Integration and Validation
  - Complete the implementation with full testing and validation
  - [ ] 7.1. Run comprehensive test suite
    - Execute all unit tests with go test ./v2/icons
    - Run race detector tests with go test -race ./v2/icons
    - Run benchmarks with go test -bench=. ./v2/icons
    - Generate and review test coverage report
    - References: Requirements 6.1-6.7
  - [ ] 7.2. Validate against requirements
    - Verify all 7 main requirements are satisfied
    - Confirm all acceptance criteria are met
    - Test memory usage is within expected ~750KB-1MB range
    - Verify startup parsing time is within 5-10ms range
    - References: Requirements 1-7, Design: Performance Considerations
